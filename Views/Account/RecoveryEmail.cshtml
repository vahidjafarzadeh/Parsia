
@{
    ViewBag.Title = "بازیابی رمز عبور";
    ViewBag.Description = "بازیابی رمز عبور";
    Layout = "~/Views/Shared/_LayoutAccount.cshtml";
}

<div class="page-loader-wrapper">
    <div class="loader">
        <div class="preloader">
            <div class="spinner-layer pl-red">
                <div class="circle-clipper left">
                    <div class="circle"></div>
                </div>
                <div class="circle-clipper right">
                    <div class="circle"></div>
                </div>
            </div>
        </div>
        <p class="ir">لطفا تا بارگزاری صفحه شکیبا باشید ...</p>
    </div>
</div>

<div class="login-box">
    <div class="logo">
        <a href="/">
            <img class="log-image" src="~/Content/images/site/logo.png" alt="logo of site" />
        </a>
        <small class="cursor-defult">بازیابی رمز عبور</small>
    </div>
    <div class="card">
        <div class="body">
            <form id="recovery" method="POST">
                <div class="msg">برای بازیابی نام کاربری خود را وارد نمایید</div>
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="material-icons">person</i>
                    </span>
                    <div class="form-line">
                        <input type="text" class="form-control" name="username" maxlength="100" minlength="8" placeholder="نام کاربری" required autocomplete="off">
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="material-icons">code</i>
                    </span>
                    <div class="form-line"  style="width: 140px">
                        <input type="text" class="form-control" name="captcha" minlength="6" maxlength="6" placeholder="کد امنیتی" required autocomplete="off">
                    </div>
                    <span class="input-group-addon" id="captchaContent">
                    </span>
                </div>
                <div class="input-group">
                    <button class="btn btn-block bg-green waves-effect full-width" type="submit">بازیابی</button>
                </div>
                <div class="input-group">
                    <a href="/" class="btn btn-block bg-pink waves-effect full-width">بازگشت به سایت</a>
                </div>
            </form>
        </div>
    </div>
</div>


@section script
{
    <script>
        $("body").addClass("login-page ls-closed");
        Captcha("captchaContent");
        var hand = new Handler();
        hand.success = function (data, textStatus, jqXhr) {
            if (data.Done) {
                if (jqXhr && jqXhr.responseJSON && jqXhr.responseJSON.Done && jqXhr.responseJSON.Result.Ticket) {
                    localStorage.setItem("ticket", jqXhr.responseJSON.Result.Ticket);
                }
                hideLoading();
                if (data.Result === "phone") {
                    swal({
                        title: "پیغام سیستم",
                        text:"کد بازیابی با موفقیت ارسال شد . کد فعال سازی ارسالی به تلفن همراه خود را وارد نمایید ",
                        timer: 4000,
                        showConfirmButton: false
                    });
                    setTimeout(() => {
                        var myHandler = new Handler();
                        myHandler.success = function (data, textStatus, jqXhr) {
                            $("body").html(data);
                        };
                        myHandler.complete = function (jqXhr) { hideLoading(); };
                        Api.getController({
                            url: "recover-phone",
                            filter: {},
                            handler: myHandler,
                            ticket: false,
                            isAsync: true,
                            setHeader: false
                        });
                    },
                        4000);
                }
                else {
                    swal({
                        title: "پیغام سیستم",
                        text:
                            "کد فعال سازی با موفقیت ارسال شد. با کلیک بر روی لینک ارسالی به ایمیل خود کلمه عبور خود را بازیابی کنید",
                        timer: 4000,
                        showConfirmButton: false
                    });
                }
            } else {
                $("#captchaContent").html("");
                Captcha("captchaContent");
                hand.configError(data);
            }
        };
        hand.complete = function (jqXhr) {

        };
        addSubmitToForm("recovery", "Account/Recovery", "formData", hand);
    </script>
}
